<?xml version="1.0" encoding="UTF-8"?> 
<project name="swing.js" basedir="." default="build"> 
 
  <property name="src.dir" value="${basedir}/src" /> 
  <property name="transpile.dir" value="${basedir}/transpile" /> 
  <property name="build.dir" value="${basedir}/build" /> 
  <property name="test.dir" value="${basedir}/test" /> 
  <property name="transpile-test.dir" value="${basedir}/transpile-test" /> 
  <property name="josetta.jar" value="${basedir}/lib/josetta-1.10.2-jar-with-dependencies.jar" /> 
  
  <target name="clean"> 
    <delete>
      <fileset dir="${build.dir}" includes="**/*-bundle-*.js"/>
    </delete> 
  </target> 
  
  <target name="version">
    <loadfile property="version" srcFile="${basedir}/version.properties"/>
  </target>
  
  <target name="transpile">
    <java classname="giada.josetta.Josetta">
      <arg value="-in"/>
      <arg value="${src.dir}"/>
      <arg value="-out"/>
      <arg value="${transpile.dir}"/>
      <classpath>
        <pathelement path="${josetta.jar}"/>
      </classpath>
    </java>
  </target>
  
  <target name="transpile-test">
    <java classname="giada.josetta.Josetta">
      <arg value="-in"/>
      <arg value="${test.dir}"/>
      <arg value="-out"/>
      <arg value="${transpile-test.dir}"/>
      <classpath>
        <pathelement path="${josetta.jar}"/>
      </classpath>
    </java>
  </target>
  
  <target name="build_js" depends="version,transpile">
    <concat destfile="${build.dir}/swing-bundle-${version}.js" fixlastline="yes">
      <filterchain>
        <linecontainsregexp negate="true">
          <regexp pattern="/* global .* */"/>
        </linecontainsregexp>
      </filterchain>
      
      <fileset dir="${transpile.dir}"/>
    </concat>
  </target>

  <target name="copy_css">
    <copy file="${src.dir}/swing.css" tofile="${build.dir}/swing-bundle-${version}.css"/>
  </target>
  
  <target name="build_js_min" depends="build_js">
    <java sourcefile="${basedir}/Minify.java">
      <arg value="https://www.toptal.com/developers/javascript-minifier/api/raw"/>
      <arg value="${build.dir}/swing-bundle-${version}.js"/>
      <arg value="${build.dir}/swing-bundle-min-${version}.js"/>
    </java>
  </target>
    
  <target name="build_css_min" depends="copy_css">
    <java sourcefile="${basedir}/Minify.java">
      <arg value="https://www.toptal.com/developers/cssminifier/api/raw"/>
      <arg value="${build.dir}/swing-bundle-${version}.css"/>
      <arg value="${build.dir}/swing-bundle-min-${version}.css"/>
    </java>
  </target>
  
  <target name="build" depends="clean,build_js_min,build_css_min">
  </target>
  
  <target name="watch">
    <java classname="giada.josetta.Josetta">
      <arg value="-in"/>
      <arg value="${src.dir}"/>
      <arg value="-out"/>
      <arg value="${transpile.dir}"/>
      <arg value="-w"/>
      <classpath>
        <pathelement path="${josetta.jar}"/>
      </classpath>
    </java>
  </target>
  
  <target name="watch-test">
    <java classname="giada.josetta.Josetta">
      <arg value="-in"/>
      <arg value="${test.dir}"/>
      <arg value="-out"/>
      <arg value="${transpile-test.dir}"/>
      <arg value="-w"/>
      <classpath>
        <pathelement path="${josetta.jar}"/>
      </classpath>
    </java>
  </target>
</project>